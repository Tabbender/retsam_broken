# Current Status
Apart from building a ROM that matches version v1.0 of Pok√©mon Platinum (US), the repository as is should allow "shifting", i.e. inserting or removing code, although this has not been tested. However, there is no guarantee as to how complex changes to the source can become before bugs arise in the resulting ROM. Since there are still NONEQUIVALENT functions left (functions where the compiled assembly is included instead as the corresponding C code does not match), changing some constant values or struct definitions could cause bugs, as said changes wouldn't be seen in the included assembly. 

**Update 14 Dec 2021** - All NONEQUIVALENT and NONMATCHING functions have been matched and made equivalent to Platinum US. There may remain some constants which have yet to be updated and/or integrated into the revised source code, but struct definitions should be mutable now.

Throughout the build, the phrase `MatchComment` has been scattered around indicating changes from Platinum JP to US, with a barebones comment indicating what was changed (except for changes taken from the Diamond/Pearl US source; these just copy the unaltered localization changes). However, this was not applied exhaustively towards every change. If you're unsure, check the commit history.

The Makefile system is very, very, very bloated and confusing to understand, and almost certainly needs a stripping down (e.g. dynamic inclusion of makefiles depending on the target system which is not necessary for this project). However, it might be better to just clean up the Makefile system as part of a standalone repository which includes only the minimum necessary to build.

Data files (in `files/`) that are part of the DS file system are not compiled from source files, and there is no intention to try to convert the JP data source files to US using the tools for JP. While it may be possible to convert and include some of the files, even then, not all files would be generated during the build. Notably, some of the tooling requires tools or data not stored in the source tree (e.g. see line 17 of `src/battle/graphic/makefile` and line 20 of `src/wazaeffect/Makefile`). In addition, it would require parsing through the confusing Makefile system, which would be discouraging to most. Also, some of the tools require Microsoft Excel to be installed, which is an extremely unfeasible requirement. Thus for now, just use modern tooling on the data files.

One thing to note is that some included (code) source files are automatically generated by tooling to generate data not included in the buildsystem, mostly because the tooling had operated on JP source files (e.g. the .h files in `include/msgdata/`), although some autogenerated source files may have been created from tools that require tooling or data not in the source tree, or possibly because the tooling was run manually on source files. Thus, any data changes which shift or add elements may need to update these included source files.

Almost all of the external SDKs and binary-only libraries used are 1:1, with a few exceptions. `libdwcppwlobby.a` and `libdwcilobby.a` of NitroDWC needed some modifications, which was made easier as source was provided but made harder since these libraries were compiled with C++. `libdwcenc.a` of NitroDWC also changed, but the compiled assembly was included since the library was provided as binary-only. `libcrypto.a` had some interesting issues in that the library is included in both the static block and overlay 97. This did not cause issues for all versions of Diamond/Pearl and Platinum JP, but in Platinum US and onwards, certain functions appeared in overlay 97 only, instead of all functions appearing in the static code block with the previous games. To work around this, the functions that needed to appear in overlay 97 were manually edited out of the library file by overwriting the symbol names, and the respective functions in overlay 97 were disassembled and included as assembly. Including the library file twice did not work as function order of the library functions was wrong, and it might have been possible that some functions had changed.

A special case is with the CodeWarrior libraries. While these come with source and the provided binaries match, building these requires using the CodeWarrior IDE which would absolutely be unfeasible for a command-line build system. For now, there is no option to modify these functions.

### Some important files
- `sdk/NitroSDK/build/buildtools/commondefs`
- `sdk/NitroSDK/build/buildtools/commondefs.cctype.CW`
- `sdk/NitroSDK/build/buildtools/modulerules`
- `sdk/NitroSDK/build/buildtools/modulerules.cctype.CW`

These four files are included in almost every Makefile in the build system (except the raw assembly for non-matching binary-only libraries). `commondefs.cctype.CW` and `modulerules.cctype.CW` are (presumably) included in the base versions of the file as part of some sort of OOP-style make system. Generally, look in these four files whenever you need to debug a makefile issue, or see how some components are compiled. A good way to debug would be to capture the command line output of all objects build.

### Building with other settings

Building Debug have not been tested at all, and almost certainly does not work, as no localization changes were ported over to debug, plus it is possible that Platinum-only debug features have been added, which definitely do not have localization changes. If you would still like to try anyway, change `PM_DEBUG` in `version`. Note that Debug may have some encoding issues with strings and Shift-JIS (see [these](84f4642a7109eaaf8e477288e745a1725322601f) [commits](https://gitgud.io/gainax/pokemon_dp/-/commit/36c28a89fb832e7a115309c4a1eaf7e921ed380b)).
